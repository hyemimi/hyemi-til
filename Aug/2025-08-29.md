# ğŸ§¾TIL

## ë‚ ì§œ: 2025-08-29 ğŸ¤•

## ìƒˆë¡œ ë°°ìš´ ë‚´ìš©

https://ko.react.dev/learn/queueing-a-series-of-state-updates

# state

stateëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ë©”ëª¨ë¦¬ë‹¤. ì»´í¬ë„ŒíŠ¸ ë‚´ì˜ ë³€ìˆ˜ ê°’ì„ ê¸°ì–µí•˜ê³ , ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

# useState

useState í›…ì€ ë‘ ê°€ì§€ì˜ ì£¼ìš” íŠ¹ì§•ì´ ìˆë‹¤.

1. ë Œë”ë§ ê°„ì— ë°ì´í„° ìœ ì§€
2. setter í•¨ìˆ˜ë¡œ ê°’ ì„¤ì • í›„ ë¦¬ë Œë”ë§ íŠ¸ë¦¬ê±°

- ë‚´ë¶€ ë™ì‘ (ì‹¤ì œ React ì½”ë“œëŠ” ì•„ë‹ˆì§€ë§Œ ê³µì‹ ë¬¸ì„œì˜ ë ˆí¼ëŸ°ìŠ¤)

```tsx
let componentHooks = [];
let currentHookIndex = 0;

// How useState works inside React (simplified).
function useState(initialState) {
  let pair = componentHooks[currentHookIndex];
  if (pair) {
    // This is not the first render,
    // so the state pair already exists.
    // Return it and prepare for next Hook call.
    currentHookIndex++;
    return pair;
  }

  // This is the first time we're rendering,
  // so create a state pair and store it.
  pair = [initialState, setState];

  function setState(nextState) {
    // When the user requests a state change,
    // put the new value into the pair.
    pair[0] = nextState;
    updateDOM();
  }

  // Store the pair for future renders
  // and prepare for the next Hook call.
  componentHooks[currentHookIndex] = pair;
  currentHookIndex++;
  return pair;
}
```

currentHookIndexëŠ” ì‹¤í–‰í•  í›…ì˜ ì¸ë±ìŠ¤ì´ê³ ,

ReactëŠ” í›…ì„ ì‹¤í–‰í•œ ë’¤ ì¸ë±ìŠ¤ë¥¼ ì¦ê°€ì‹œí‚¤ê³ , ë‹¤ìŒ state ìŒì„ ë°˜í™˜í•œë‹¤.

ì´ë ‡ê²Œ ì‹¤í–‰í•  í›…ì˜ ìˆœì„œê°€ ì •í•´ì ¸ ìˆìœ¼ë¯€ë¡œ ì¡°ê±´ë¶€ë¡œ í›…ì„ ì‹¤í–‰ ì‹œí‚¤ë©´ ê¼¬ì´ê²Œ ë˜ë¯€ë¡œ Reactì—ì„œ ê¸ˆì§€í•˜ëŠ” ê²ƒì´ë‹¤.

# State ì—…ë°ì´íŠ¸

ReactëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì˜ ëª¨ë“  ì½”ë“œê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.

ë”°ë¼ì„œ í•˜ë‚˜ì˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ setColor('red'); setColor('sky'); setColor('blue')ë¥¼ í•œë‹¤ë©´ color ê°’ì´ â€˜blueâ€™ê°€ ëœë‹¤.

ê·¸ë ‡ë‹¤ë©´ ë™ì¼í•œ state ê°’ì„ ì´ìš©í•´ì„œ ë³€ê²½í•´ì•¼ í•  ë•ŒëŠ” ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

```tsx
import { useState } from "react";

export default function Counter() {
  const [number, setNumber] = useState(0);

  return (
    <>
      <h1>{number}</h1>
      <button
        onClick={() => {
          setNumber((n) => n + 1);
          setNumber((n) => n + 1);
          setNumber((n) => n + 1);
        }}
      >
        +3
      </button>
    </>
  );
}
```

setNumber( n â‡’ n+1 )ê³¼ ê°™ì´ ì—…ë°ì´í„° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ê° ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ê°€ íì— ë“±ë¡ë˜ê³ , ì°¨ë¡€ë¡œ ì‹¤í–‰ë˜ë©´ì„œ ê¸°ì¡´ì˜ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ stateë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.

# state ì—…ë°ì´íŠ¸ í•˜ê¸° - ê°ì²´

ì „ê°œ ë¬¸ë²•ì„ ì‚¬ìš©í•´ì„œ ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤.

Immer ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì²˜ìŒ ë³´ëŠ” ë¬¸ë²•ì´ì–´ì„œ ì¡°ê¸ˆ ê³µë¶€í•´ë³´ì•˜ë‹¤.

```tsx
import { useImmer } from "use-immer";

export default function Form() {
  const [person, updatePerson] = useImmer({
    name: "Niki de Saint Phalle",
    artwork: {
      title: "Blue Nana",
      city: "Hamburg",
      image: "https://i.imgur.com/Sd1AgUOm.jpg",
    },
  });

  function handleNameChange(e) {
    updatePerson((draft) => {
      draft.name = e.target.value;
    });
  }

  function handleTitleChange(e) {
    updatePerson((draft) => {
      draft.artwork.title = e.target.value;
    });
  }

  function handleCityChange(e) {
    updatePerson((draft) => {
      draft.artwork.city = e.target.value;
    });
  }

  function handleImageChange(e) {
    updatePerson((draft) => {
      draft.artwork.image = e.target.value;
    });
  }

  return (
    <>
      <label>
        Name:
        <input value={person.name} onChange={handleNameChange} />
      </label>
      <label>
        Title:
        <input value={person.artwork.title} onChange={handleTitleChange} />
      </label>
      <label>
        City:
        <input value={person.artwork.city} onChange={handleCityChange} />
      </label>
      <label>
        Image:
        <input value={person.artwork.image} onChange={handleImageChange} />
      </label>
      <p>
        <i>{person.artwork.title}</i>
        {" by "}
        {person.name}
        <br />
        (located in {person.artwork.city})
      </p>
      <img src={person.artwork.image} alt={person.artwork.title} />
    </>
  );
}
```

useState ëŒ€ì‹  ì‚¬ìš©í•´ì£¼ë©´ ëœë‹¤.

ê¸°ì¡´ì—ëŠ” ê°ì²´ë‚˜ ë°°ì—´ì„ í¼ì³ì¤€ ë‹¤ìŒ(ì „ê°œ ë¬¸ë²•) ìˆ˜ì •í•˜ê³ ì í•˜ëŠ” í‚¤ ê°’ì„ ì…ë ¥í•´ ìˆ˜ì •í–ˆëŠ”ë°, immerë¥¼ ì‚¬ìš©í•˜ë©´ ë³€ê²½í•˜ê³ ì í•˜ëŠ” ê²ƒë§Œ ë³€ê²½í•´ì£¼ë©´ ëœë‹¤.

# state ì—…ë°ì´íŠ¸ í•˜ê¸° - ë°°ì—´

ë§ˆì°¬ê°€ì§€ë¡œ ë°°ì—´ì˜ ê¸°ì¡´ ê°’ì„ ë³µì‚¬í•´ì„œ ìƒˆë¡œìš´ ë°°ì—´ì„ stateë¡œ ì„¤ì •í•´ì¤€ë‹¤.

ìì£¼ ì‚¬ìš©ë˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ë©”ì†Œë“œëŠ” map, slice, filter, concat ë“±ì´ ìˆë‹¤.

# ì±Œë¦°ì§€ 1

- ì¥ë°”êµ¬ë‹ˆ í•­ëª© ì—…ë°ì´íŠ¸ (count ì—…ë°ì´íŠ¸)

```tsx
import { useState } from "react";

const initialProducts = [
  {
    id: 0,
    name: "Baklava",
    count: 1,
  },
  {
    id: 1,
    name: "Cheese",
    count: 5,
  },
  {
    id: 2,
    name: "Spaghetti",
    count: 2,
  },
];

export default function ShoppingCart() {
  const [products, setProducts] = useState(initialProducts);

  function handleIncreaseClick(productId) {
    // ì´ ë¶€ë¶„ !!
    setProducts(
      products.map((product) => {
        if (product.id === productId) {
          return {
            ...product,
            count: product.count + 1,
          };
        } else {
          return product;
        }
      })
    );
  }

  return <ul>// ìƒëµ</ul>;
}
```

map ì‚¬ìš©í•´ ìˆœíšŒí•˜ë©°, ë°”ê¾¸ë ¤ëŠ” product IDì— í•´ë‹¹í•˜ë©´ ê°ì²´ë¥¼ í¼ì¹œ ë’¤ ìˆ˜ì •í•˜ë ¤ëŠ” countë§Œ ìˆ˜ì •í•œë‹¤.

ë°”ê¾¸ì§€ ì•ŠëŠ” ê°’ë“¤ì€ ë‹¨ìˆœíˆ ë°˜í™˜í•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ ìƒˆë¡œìš´ ë°°ì—´ì„ ìƒì„±í•´ productë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.

# ì±Œë¦°ì§€ 2

- ì¥ë°”êµ¬ë‹ˆ í•­ëª© ì‚­ì œ

```tsx
import { useState } from "react";

const initialProducts = [
  {
    id: 0,
    name: "Baklava",
    count: 1,
  },
  {
    id: 1,
    name: "Cheese",
    count: 5,
  },
  {
    id: 2,
    name: "Spaghetti",
    count: 2,
  },
];

export default function ShoppingCart() {
  const [products, setProducts] = useState(initialProducts);

  function handleIncreaseClick(productId) {
    setProducts(
      products.map((product) => {
        if (product.id === productId) {
          return {
            ...product,
            count: product.count + 1,
          };
        } else {
          return product;
        }
      })
    );
  }

  return (
    <ul>
      {products.map((product) => (
        <li key={product.id}>
          {product.name} (<b>{product.count}</b>)
          <button
            onClick={() => {
              handleIncreaseClick(product.id);
            }}
          >
            +
          </button>
          <button>â€“</button>
        </li>
      ))}
    </ul>
  );
}
```

```tsx
import { useState } from "react";

const initialProducts = [
  {
    id: 0,
    name: "Baklava",
    count: 1,
  },
  {
    id: 1,
    name: "Cheese",
    count: 5,
  },
  {
    id: 2,
    name: "Spaghetti",
    count: 2,
  },
];

export default function ShoppingCart() {
  const [products, setProducts] = useState(initialProducts);

  function handleIncreaseClick(productId) {
    setProducts(
      products.map((product) => {
        if (product.id === productId) {
          return {
            ...product,
            count: product.count + 1,
          };
        } else {
          return product;
        }
      })
    );
  }

  function handleDecreaseClick(productId) {
    let nextProducts = products.map((product) => {
      if (product.id === productId) {
        return {
          ...product,
          count: product.count - 1,
        };
      } else {
        return product;
      }
    });
    nextProducts = nextProducts.filter((p) => p.count > 0);
    setProducts(nextProducts);
  }

  return (
    <ul>
      {products.map((product) => (
        <li key={product.id}>
          {product.name} (<b>{product.count}</b>)
          <button
            onClick={() => {
              handleIncreaseClick(product.id);
            }}
          >
            +
          </button>
          <button
            onClick={() => {
              handleDecreaseClick(product.id);
            }}
          >
            â€“
          </button>
        </li>
      ))}
    </ul>
  );
}
```

ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ì—ì„œëŠ” ì™¸ë¶€ ìƒíƒœì¸ productsì— ì ‘ê·¼í•´ë„ ë˜ëŠ”ê°€ì— ëŒ€í•´ì„œ í—·ê°ˆë ¸ëŠ”ë°, ìˆœìˆ˜ì„±ì€ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— í•´ë‹¹ë˜ê³ , ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ëŠ” ìˆœìˆ˜í•  í•„ìš” ì—†ìœ¼ë¯€ë¡œ, productsì— ì ‘ê·¼í•´ë„ ëœë‹¤.

# ì±Œë¦°ì§€ 3

```tsx
import { useState } from "react";
import AddTodo from "./AddTodo.js";
import TaskList from "./TaskList.js";

let nextId = 3;
const initialTodos = [
  { id: 0, title: "Buy milk", done: true },
  { id: 1, title: "Eat tacos", done: false },
  { id: 2, title: "Brew tea", done: false },
];

export default function TaskApp() {
  const [todos, setTodos] = useState(initialTodos);

  function handleAddTodo(title) {
    const newTodo = { id: nextId++, title: title, done: false };
    setTodos([...todos, newTodo]);
    // todos.push({
    //   id: nextId++,
    //   title: title,
    //   done: false
    // });
  }

  function handleChangeTodo(nextTodo) {
    setTodos(
      todos.map((todo) => {
        if (todo.id === nextTodo.id) {
          return nextTodo;
        } else {
          return todo;
        }
      })
    );
  }

  function handleDeleteTodo(todoId) {
    setTodos(todos.filter((todo) => todo.id !== todoId));
  }

  return (
    <>
      <AddTodo onAddTodo={handleAddTodo} />
      <TaskList
        todos={todos}
        onChangeTodo={handleChangeTodo}
        onDeleteTodo={handleDeleteTodo}
      />
    </>
  );
}
```

í‹€ë ¸ë˜ ê²ƒì€ filter í•¨ìˆ˜ ì‚¬ìš© ì¤‘ì— {â€¦}ë¥¼ ì“°ë©´ ê¼­ returnì„ ëª…ì‹œí•´ì£¼ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

## ì˜¤ëŠ˜ì˜ íšŒê³ 

ì˜¤ëŠ˜ì€ React ê³µì‹ ë¬¸ì„œë¥¼ ì½ìœ¼ë©°, ì»´í¬ë„ŒíŠ¸ì˜ ë©”ëª¨ë¦¬ì¸ stateì— ëŒ€í•´ì„œ ê¸°ì´ˆì ìœ¼ë¡œ ë‹¤ì‹œ ë³µìŠµí•´ë³´ì•˜ë‹¤.

ì•„ëŠ” ë‚´ìš©ë“¤ì´ ë§ì•˜ì§€ë§Œ ë””í…Œì¼í•˜ê²Œ ì•Œì§€ëŠ” ëª»í–ˆë˜ ê²ƒ ê°™ì•„ì„œ ì˜ë¯¸ ìˆëŠ” ì‹œê°„ì´ì—ˆë‹¤.

stateë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì€ ëŒ€ì²´ë¡œ ê°ì²´ë‚˜ ë°°ì—´ì´ë‚˜ ìƒˆë¡œìš´ ê²ƒì„ ìƒì„±í•´ì„œ êµì²´í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤ëŠ” ê²ƒê³¼,

ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´ë¶€ì˜ ì½”ë“œë¥¼ ì „ë¶€ ìˆ˜í–‰í•œ í›„ì— stateë¥¼ ë³€ê²½í•œë‹¤ëŠ” ê²ƒ, ì—…ë°ì´í„° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ì „ state ê°’ì„ ì´ìš©í•´ ì—°ì‚°í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì— ëŒ€í•´ì„œë„ ë³µìŠµí–ˆë‹¤.

ê°€ì¥ ì¬ë¯¸ìˆì—ˆë˜ ê²ƒì€ ì±Œë¦°ì§€ì¸ë°, React ê³µì‹ ë¬¸ì„œì˜ ì±Œë¦°ì§€ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ë„ë¡ ê³ ì³ë³´ì•˜ë‹¤.

íŠ¹íˆ ë°°ì—´ stateë¥¼ ì—…ë°ì´íŠ¸ í•  ë•ŒëŠ” ì´ì „ stateë¥¼ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ê²ƒê³¼,

ì œê±°í•  ë•ŒëŠ” filterë‚˜ slice (spliceëŠ” ê¶Œì¥ë˜ì§€ ì•ŠëŠ”ë‹¤.),

ì¶”ê°€í•  ë•ŒëŠ” pushê°€ ì•„ë‹ˆë¼ ì „ê°œí˜• ë¬¸ë²•ì„ ì‚¬ìš©í•œ ë’¤ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë„£ì–´ì£¼ëŠ” ê²ƒ,

ìˆ˜ì •í•  ë•ŒëŠ” mapì„ í†µí•´ ë°°ì—´ì„ ìˆœíšŒí•˜ë©° ìˆ˜ì •í•˜ê³ ì í•˜ëŠ” ì•„ì´í…œì„ ì°¾ê³ , ìˆ˜ì •í•´ return í•œë‹¤. ê·¸ ì™¸ ì•„ì´í…œë“¤ì€ ë°”ë¡œ return í•œë‹¤.

ì–´ì°Œë³´ë©´ ë‹¹ì—°í•˜ê²Œ ì‚¬ìš©í•˜ê³  ìˆì—ˆë˜ ê²ƒë“¤ì´ì§€ë§Œ ì´ë ‡ê²Œ ê¸€ë¡œì„œ ì •ë¦¬í•˜ë‹ˆ ë” ì´í•´ê°€ ì˜ ë˜ê³  ê·¸ë™ì•ˆ ë‚´ê°€ ëª¨ë¥´ëŠ” ë””í…Œì¼ë“¤ì´ ë§ì•˜êµ¬ë‚˜, ìƒê°í–ˆë‹¤.
