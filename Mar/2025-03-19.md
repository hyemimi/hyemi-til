# ğŸ§¾TIL
## ë‚ ì§œ: 2025-03-19 ğŸ¦€

## ìƒˆë¡œ ë°°ìš´ ë‚´ìš© & íšŒê³ 
## JPA ì—°ê´€ ê´€ê³„ ë§¤í•‘ (ë‹¨ë°©í–¥, ì–‘ë°©í–¥)
- user entity

```java
@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
@Table(name = "user")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true)
    private String email;

    @Column(nullable = false)
    private String password;

    @Column(nullable = false, length = 10, unique = true)
    private String nickname;

    private String profile_image_url;

    @Column(nullable = false, updatable = false)
    @Builder.Default
    private LocalDateTime created_at = LocalDateTime.now();

    private LocalDateTime deleted_at;
}

```

- comment entity

```java
@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Comment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "post_id", nullable = false)
    private Post post;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    @Column(nullable = false, columnDefinition = "TEXT")
    private String comment_content;

    @Column(nullable = false, updatable = false)
    private LocalDateTime created_at = LocalDateTime.now();

    private LocalDateTime updated_at;
}
```

- post entity

```java
@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Post {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    @Column(nullable = false, length = 100)
    private String title;

    @Column(nullable = false, columnDefinition = "TEXT")
    private String post_content;

    private String post_image_url;

    @Column(nullable = false)
    private int like_count = 0;

    @Column(nullable = false)
    private int views_Count = 0;

    @Column(nullable = false, updatable = false)
    @Builder.Default
    private LocalDateTime created_at = LocalDateTime.now();

    private LocalDateTime updated_at;

  
}
```

`ê²Œì‹œê¸€`ì´ `ìœ ì €` ì°¸ì¡° / `ëŒ“ê¸€`ì´ `ìœ ì €`, `ê²Œì‹œê¸€` ì°¸ì¡° í•˜ë„ë¡ ìœ„ì™€ ê°™ì´ ë‹¨ë°©í–¥ìœ¼ë¡œ êµ¬ì„±í–ˆë‹¤.

ê·¸ëŸ°ë° ë¬¸ì œê°€ ìƒê²¼ë‹¤. ê²Œì‹œê¸€ì´ ì‚­ì œë˜ë©´ ëŒ“ê¸€ë„ ëª¨ë‘ ì‚­ì œí•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ì—†ì—ˆë‹¤.

ê·¸ ì´ìœ ëŠ” ëŒ“ê¸€ë§Œ ê²Œì‹œê¸€ì„ ì°¸ì¡°í•˜ê³ , ê²Œì‹œê¸€ â†’ ëŒ“ê¸€ ë°©í–¥ì˜ ì°¸ì¡°ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.

`Post`ë¥¼ ì‚­ì œí•´ë„ JPAëŠ” ê´€ë ¨ëœ `Comment`ê°€ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤.

ë˜, ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì´ ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ë³´ë‹¤ í›¨ì”¬ íš¨ìœ¨ì ì´ê³  ì‹¤ìš©ì ì¸ íŒ¨í„´ì´ë©° ê¶Œì¥ëœë‹¤ê³  í•œë‹¤. 

ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ì€ ì„±ëŠ¥ ì´ìŠˆ ê°€ëŠ¥ì„±ì´ ë†’ê¸° ë•Œë¬¸ì´ë‹¤. 

ì˜¤ â€¦ ERD ì„¤ê³„ëŠ” ì •ë§ ì²˜ìŒì— ì œëŒ€ë¡œ í•´ì•¼ í•˜ëŠ” êµ¬ë‚˜ ê¹¨ë‹¬ì•˜ë‹¤. 

ê²°êµ­, Post entityì—ì„œ Comment entityì™€ì˜ **ì–‘ë°©í–¥ ê´€ê³„**ë¥¼ ì„¤ì •í•´ì£¼ì—ˆë‹¤.

- Post (`OneToMany`, `mappedBy` , `CascadeType.ALL`)

```java
// ì–‘ë°©í–¥ ê´€ê³„ ì„¤ì • (1:N)
    @OneToMany(mappedBy = "post", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Comment> comments = new ArrayList<>();
```

- Comment (`ManyToOne` , `JoinColumn` ìœ¼ë¡œ ì™¸ë˜í‚¤ ì„¤ì •)

```java
@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Comment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY) // ë‹¤ëŒ€ì¼ ê´€ê³„ ìœ ì§€
    @JoinColumn(name = "post_id", nullable = false) // FK ì„¤ì •
    private Post post;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    @Column(nullable = false, columnDefinition = "TEXT")
    private String comment_content;

    @Column(nullable = false, updatable = false)
    private LocalDateTime created_at = LocalDateTime.now();

    private LocalDateTime updated_at;
}
```

Comment ì—”í‹°í‹°ì—Â @ManyToOneê³¼Â @JoinColumnì„ ì‚¬ìš©í•˜ì—¬ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ê³ , íŒ€ ì—”í‹°í‹°ì—ëŠ”Â @OneToManyì™€Â mappedByë¥¼ ì‚¬ìš©í•˜ì—¬ ì—°ê´€ ê´€ê³„ë¥¼ ì„¤ì •í–ˆë‹¤.

Comment ì—”í‹°í‹°ê°€ ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ë©°, Post ì—”í‹°í‹°ëŠ” mappedByë¡œ ì¸í•´ ì½ê¸° ì „ìš© ê´€ê³„ê°€ ëœë‹¤. 

ê·¸ë ‡ê²Œ Commentì™€ Postë¥¼ ì–‘ë°©í–¥ ê´€ê³„ë¡œ ë³€ê²½ í›„,  ë§ˆì°¬ê°€ì§€ë¡œ ìœ ì €ë§ˆë‹¤ ìƒì„±í•œ ëŒ“ê¸€ê³¼ ê²Œì‹œê¸€ë“¤ì„ ì¡°íšŒí•´ì•¼ í•˜ëŠ”ë° ì–´ë–»ê²Œ í•˜ì§€? ìƒê°í•˜ë‹¤ ìœ ì € ì—”í‹°í‹° ë˜í•œ ëŒ“ê¸€ê³¼ ê²Œì‹œê¸€ì„ ì°¸ì¡°í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹«ê³  ì—”í‹°í‹°ë¥¼ ë‹¤ ì–‘ë°©í–¥ìœ¼ë¡œ ë‹¤ì‹œ ìˆ˜ì •í•´ì£¼ì—ˆë‹¤.

