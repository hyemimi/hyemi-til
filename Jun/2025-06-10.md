# π§ΎTIL

## λ‚ μ§: 2025-06-10 β¨

## μƒλ΅ λ°°μ΄ λ‚΄μ©

https://tanstack.com/query/latest/docs/framework/react/reference/useInfiniteQuery

---

## μµμ…

- **`queryFn` : μ‹¤ν–‰ν•  ν•¨μ. promise λ°ν™ (μ¦‰ async-await λ“±μΌλ΅ api νΈμ¶ν•λ” ν•¨μ)**
- **`initialPageParam: TPageParam` : ν¨μΉν•  μ²« νμ΄μ§€μ νλΌλ―Έν„°**
- **`getNextPageParam: (lastPage, allPages, lastPageParam, allPageParams) => TPageParam | undefined | null`**
  - lastPageλ” λ§μ§€λ§‰μΌλ΅ api νΈμ¶ν• λ°μ΄ν„° μ „μ²΄λΌκ³  λ³Ό μ μλ‹¤.
  - λ‹¤μ νμ΄μ§€ νλΌλ―Έν„° κ²°μ •
- **`getPreviousPageParam: (firstPage, allPages, firstPageParam, allPageParams) => TPageParam | undefined | null`**
  - μ΄μ „ νμ΄μ§€ νλΌλ―Έν„° κ²°μ •

## Return

- `data.pages` : λ¨λ“  api μ‘λ‹µ(= λ¨λ“  νμ΄μ§€)μ΄ μ“μ΄λ” λ°°μ—΄
- `isFetchingNextPage` : λ‹¤μ νμ΄μ§€ λ΅λ”© μ¤‘μ„μ„ κµ¬λ¶„ν•  λ• μ‚¬μ©ν•  μ μμ
- `isFetchingPreviousPage` : μ΄μ „ νμ΄μ§€ λ΅λ”© μ¤‘μ„μ„ κµ¬λ¶„ν•  λ• μ‚¬μ©ν•  μ μμ
- `fetchNextPage` : λ‹¤μ νμ΄μ§€ ν¨μΉν•  λ• νΈμ¶.
- `fetchPreviousPage` : μ΄μ „ νμ΄μ§€ ν¨μΉν•  λ• νΈμ¶
- `hasNextPage` : λ‹¤μ νμ΄μ§€κ°€ μλ”μ§€ μ—¬λ¶€
- `hasPreviousPage` : μ΄μ „ νμ΄μ§€κ°€ μλ”μ§€ μ—¬λ¶€

## κµ¬ν„ν•  API λ…μ„Έ

- GET) λ“κΈ€ μ΅°ν
  <request>
  /api/backend/v3/posts/{postId}/comments
  `required` postId
  `optional` cursorId, size

<response>

```json
 "data": {
    "postId": 1136,
    "nextCursorId": 40,
    "hasNext": true,
    "comments": [
     ...
    ]
  }
```

`nextCursorId` λ” λ‹¤μ νμ΄μ§€ νλΌλ―Έν„°

`hasNext` λ” λ‹¤μ νμ΄μ§€κ°€ μ΅΄μ¬ν•λ”μ§€ μ—¬λ¶€

## react-query κµ¬ν„

```tsx
const {
  data,
  fetchNextPage,
  hasNextPage,
  isFetchingNextPage,
  isLoading,
  isError,
  error,
} = useInfiniteQuery({
  queryKey: ["comments", commentId],
  queryFn: ({ pageParam }) => fetchComments({ pageParam, commentId }),
  initialPageParam: null,
  getNextPageParam: (lastPage) => {
    // hasNextκ°€ trueμ΄κ³  nextCursorIdκ°€ μμΌλ©΄ λ‹¤μ νμ΄μ§€ νλΌλ―Έν„° λ°ν™
    return lastPage.hasNext ? lastPage.nextCursorId : undefined;
  },
});
```

`useQuery` μ™€ λ‹¤λ¥Ό λ°” μ—†μ§€λ§ `useInfiniteQuery` μ κ²½μ° λ¬΄ν•μ¤ν¬λ΅¤μ„ κµ¬ν„ν•  λ• μ‚¬μ©λλ‹¤.

μµμ…μ„ ν•λ‚μ”© μ‚΄ν΄λ³΄μ.

queryKeyλ” queryλ¥Ό κµ¬λ¶„ν•λ” ν‚¤μ΄λ‹¤. useQueryμ™€ λ™μΌν•λ‹¤.

```tsx
queryFn: ({ pageParam }) => fetchComments({ pageParam, commentId });
```

queryFnλ„ λ§μ°¬κ°€μ§€λ΅ λ™μΌν•λ°, `pageParam` μ΄ μ–΄λ””μ„ μ¤λλƒκ°€ λ‹¤λ¥΄λ‹¤.

```tsx
initialPageParam: null;
```

`initialPageParam` μ€ μ²« νμ΄μ§€ νλΌλ―Έν„°μ΄λ‹¤. μ²μμ€ nullλ΅ μ„¤μ •ν•μ€λ‹¤.

```tsx
getNextPageParam: (lastPage) => {
      // hasNextκ°€ trueμ΄κ³  nextCursorIdκ°€ μμΌλ©΄ λ‹¤μ νμ΄μ§€ νλΌλ―Έν„° λ°ν™
      return lastPage.hasNext ? lastPage.nextCursorId : undefined;
},
```

μµμ… μ¤‘ ν•λ‚μΈ `getNextPageParam` μ—μ„ μ¨λ‹¤. λ‹¤μ νμ΄μ§€κ°€ μμ„ κ²½μ° λ‹¤μ νμ΄μ§€ νλΌλ―Έν„°λ¥Ό λ°ν™ν•λ‹¤.

sizeκ°€ 10μΌ λ• ν„μ¬ νλΌλ―Έν„°κ°€ 30μ΄λΌλ©΄ 40μ΄ λ‹¤μ νλΌλ―Έν„°κ°€ λλ‹¤.

```tsx
fetchNextPage();
```

μ΄ν›„ `fetchNextPage` λ¥Ό μ‹¤ν–‰ν•λ©΄ μ΄μ „μ— κµ¬ν•΄λ†“μ€ λ‹¤μ νμ΄μ§€ νλΌλ―Έν„°λ¥Ό λ€μƒμΌλ΅ fetch ν•κ² λλ‹¤.

```tsx
queryFn: ({ pageParam }) => fetchComments({ pageParam, commentId });
```

`pageParam` μΌλ΅ λ“¤μ–΄μ¤κ² λλ” κ²ƒμ΄λ‹¤!

## μ¤λμ νκ³ 

μ¤λμ€ λ¬΄ν•μ¤ν¬λ΅¤μ„ κµ¬ν„ν•κΈ° μ „ @tanstack/react-queryμ κ³µμ‹ λ¬Έμ„λ¥Ό μ½μΌλ©° κ΄€λ ¨ μµμ…, λ¦¬ν„΄κ°’λ“¤μ— λ€ν•μ—¬

μ •λ¦¬λ¥Ό ν• λ’¤ λ¬΄ν•μ¤ν¬λ΅¤μ„ κµ¬ν„ν•κΈ° μ„ν• νλ¦„μ— λ€ν•΄ κ³µλ¶€ν•΄λ³΄μ•λ‹¤.

μ‚¬μ‹¤ μ²μμ—” λ§μμ΄ κΈ‰ν•΄μ Έ λ νΌλ°μ¤λ¥Ό μ°Έκ³ ν•΄ λΉ λ¥΄κ² κµ¬ν„ν•λ ¤κ³  ν–μ§€λ§ μ΄λ ‡κ² κ³µμ‹ λ¬Έμ„λ¥Ό μ½κ³ 

μ§μ ‘ νλ¦„μ„ μ΄ν•΄ν•΄λ³΄λ” κ²ƒλ„ κ°λ° μ‹¤λ ¥κ³Ό μ†λ„λ¥Ό ν–¥μƒν•κΈ° μ„ν• μΆ‹μ€ λ°©λ²•μΈ κ²ƒ κ°™λ‹¤.

μ•„λ¬΄λλ„ λ¨λ¥΄κ³  μ“°λ” κ²ƒλ³΄λ‹¨ μ•κ³  μ“°λ” κ² λ” ν¨μ¨μ΄ μΆ‹μ€ κ²ƒ κ°™λ‹¤.
