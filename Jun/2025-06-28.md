# 🧾TIL

## 날짜: 2025-06-28 👽

## 새로 배운 내용

# 1. 성능 개선 필요성의 대두

단일 저장소, 단일 서비스 였다가 (`CREATE-REACT-APP@4.X`

`REACT@16.X`)

→ 마이크로 서비스로 분리하기 시작

→ 공통적인 비즈니스 로직은 어떻게? → private/public npm registry 사용했음

현재 대부분의 서비스는 Next.js 서버 사이드 렌더링을 도입했다.

그런데, 서비스 초기 로딩 속도가 느림을 확인했다.

사용 중인 코드를 알 수 있는 **크롬 개발자 모드의 coverage를 확인**했다. 50%는 사용되지 않는 것으로 판단되었다.

→ 불필요한 자바스크립트 리소스를 삭제하자!

# 2. 불필요한 리소스 구별하고 삭제하기

## 2.1 지원 가능한 브라우저 범위

흩어져 있는 마이크로 서비스들이 지원할 수 있는 브라우저 범위를 통일해야 한다고 생각되었음 (브라우저 리스트 하나로 통일)

패키지로서 관리, 인터넷 익스플로러 드랍, 따라서 불필요한 코드가 많이 줄었음.

## 2.2 lottie 내부 이미지 압축

sharp 패키지 사용하여 base64 이미지도 같이 압축

## 2.2 svg를 렌더링하는 리액트 컴포넌트 최적화

`@naverpage/optimize-svg-components`

svg이미지 같은 경우 props가 바뀔 필요가 없어 메모이제이션 하는 것도 필요했음.

react 내부에 있는 svg 요소를 추출해 svgo 패키지를 사용하여 압축하는 과정을 eslint —fix 를 통해 자동으로 적용 (eslint plugin 직접 개발)

## 2.3 잘못 사용하고 있는 리소스 제외 기법

vConsole: 프로덕션 이미지에 들어가 있었다.

제외하도록 했는데 번들에 들어가 있었다.

서버사이드 단계에서 불필요한 리소스 필터링할 수 있도록 구축

## 2.4 네이티브 기능 적극 사용

- html-entities → DomParser
- axios → native fetch로 변경
  - axios를 edge runtime에서 사용할 수 없었다
- lodash → 자체 구현
- 자체 구현 상태 관리 라이브러리 개발

# 3. NPM 라이브러리의 효율적인 관리

## 3.1 CommonJS는 트리쉐이킹이 어렵다

제약 조건이 까다롭다.

트리셰이킹과 전체 번들 사이즈가 중요한 클라이언트는 ESModule

## 3.2 듀얼 패키지 환경에서 최선의 npm 패키지 구조는?

## 3.3 package.json

## 3.4 구형 라이브러리와 ESModule 호환성 문제

patch를통해 npm 패키지의 유지보수 여부와 관계 없이 수정

# 5. 서비스와 패키지 크기 지속적 파악

- github action 기반 CI 개발
  서비스와 패키지 크기의 변경을 한 눈에 알 수 있다.
- 정적 분석 도구를 만들어 패키지 사용 현황 분석
  - babel, typescript-eslint 등 AST 분석 도구로 private npm 패키지 사용 현황 파악
  - 서비스에서 어떤 패키지 버전을 사용하고 있는지 확인
- 미래는 ESModule에 있다
  - 배럴 파일: 트리쉐이킹에 허들이 될 뿐
  - 듀얼 패키지는 엄밀히 말하면 동일한 코드가 아니다.
  - 듀얼 패키지는 빌드 속도 저하.
- 답은 브라우저 리소스에 있다.
- 불필요한 코드와의 전쟁
  - 크롬 개발자 도구 coverage와 gihub action 적극 활용
  - npm 패키지 설치할 때는 필요한 기능만 있나? 트리셰이킹? 자체구현은?
- 웹 서비스 기술 스택 업데이트는 종종 해주자.

## 오늘의 회고

오늘은 네이버 deview 24 당시 번들 사이즈 최적화를 주제로 한 컨퍼런스 영상을 시청했다.

네이버페이 FE가 마이크로 서비스이고, react, next 등을 혼합해서 사용중이며

그 중에서도 Next를 많이 사용중이라니 새로운 사실을 알게 되었다.

또한 내가 프로젝트를 개발하면서 맞닥뜨렸던 svg 이미지 최적화 문제 해결 과정도 반가웠다.

직접 eslint plugin을 만들어 자동 최적화가 진행하도록 했다니,, 나는 단순히 png 이미지로 변환했는데 근본적인 해결책이 아니었단 생각에 반성이 되었다.. 아무래도 SVG 이미지가 벡터 형식이라 깨짐이 없으니

번들 사이즈 모니터링은 github actions로 바로 확인 가능하도록 했다니!

아무튼 배울 것들은 끝도 없는 것 같다❤️‍🔥❤️‍🔥❤️‍🔥
