# ğŸ§¾TIL

## ë‚ ì§œ: 2025-05-03 ğŸ¤ºğŸ¤–

## ìƒˆë¡œ ë°°ìš´ ë‚´ìš©

mvp ê°œë°œ ê¸°ê°„ì´ ì´‰ë°•í•´ì„œ ê·¸ëƒ¥ ë°±ì—”ë“œ ë ˆí¬ì§€í† ë¦¬ë¥¼ í´ë¡ í•´ì„œ ë¹ ë¥´ê²Œ apië¥¼ ì—°ê²°í•´ë³´ê¸°ë¡œ í–ˆë‹¤.
ê·¸ëŸ¬ë‹¤ ë°œê²¬í•œ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ë“¤..

## 1. /api/v1/auth/callback?code=â€â€ get â†’ post ë³€ê²½ í•„ìš”

api ì‹œíŠ¸ì— ê¸°ì…ë˜ì–´ ìˆëŠ” ë©”ì†Œë“œì™€ ë‹¤ë¥´ë‹¤.

## 2. isRegistered â†’ registeredë¡œ í”„ë¡ íŠ¸ì— ì „ë‹¬ë˜ëŠ” ë¬¸ì œ

```java

private boolean isRegistered;
```

ì´ë ‡ê²Œ ë˜ì–´ ìˆìœ¼ë©´, **Lombok + Jackson** ì¡°í•©ì—ì„œëŠ” getterê°€ ì•„ë˜ì²˜ëŸ¼ ë§Œë“¤ì–´ì§„ë‹¤.

```java

public boolean isRegistered() {
    return isRegistered;
}

```

ê·¸ëŸ°ë° **Jacksonì€ boolean íƒ€ì…ì„ ì§ë ¬í™”í•  ë•Œ `is` prefixë¥¼ ì œê±°í•˜ê³  í•„ë“œ ì´ë¦„ìœ¼ë¡œ ì¸ì‹**

### ì¦‰,

| Java í•„ë“œëª…    | ìƒì„±ëœ getter     | JSON key (í”„ë¡ íŠ¸ì—ì„œ ë°›ëŠ” ê°’) |
| -------------- | ----------------- | ----------------------------- |
| `isRegistered` | `isRegistered()`  | `registered` âœ…               |
| `registered`   | `getRegistered()` | `registered` âœ…               |

ìš”ê±´ í”„ë¡ íŠ¸ ì¸¡ì—ì„œ ë³€ìˆ˜ëª… ìˆ˜ì •í•´ë‘ì—ˆìŠµë‹ˆë‹¤

## 3. CORS

ğŸ“¢

1ì°¨ í•´ê²°ì±…

`@CrossOrigin(origins = "*")` ì„ ë§¤ ì»¨íŠ¸ë¡¤ëŸ¬ ë§ˆë‹¤ ì ìš©

### í•´ë‹¹ ë°©ë²•ì´ ë¬¸ì œê°€ ë˜ëŠ” ì´ìœ 

Spring Boot 3.xë¶€í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ì„œë²„ì—ì„œ ì¿ í‚¤ì— `SameSite=Lax` í˜¹ì€ `SameSite=Strict`ê°€ ì„¤ì •ë˜ì–´ ìˆë‹¤.**

controllerì— `@CrossOrigin(origins = "*")`ì´ ë¶™ì–´ ìˆê³ , í”„ë¡ íŠ¸ëŠ” ë‹¤ë¥¸ ë„ë©”ì¸(`localhost:5173`)ì—ì„œ ìš”ì²­í•  ë•Œ

â†’ ë¸Œë¼ìš°ì €ê°€ **ì¿ í‚¤ë¥¼ ì°¨ë‹¨í•˜ê±°ë‚˜**,

â†’ Springì´ **ë³´ì•ˆ ìœ„ë°˜ìœ¼ë¡œ ì˜ˆì™¸ë¥¼ ë˜ì§ˆ ìˆ˜ ìˆìŒ**

ğŸ“¢

2ì°¨ í•´ê²°ì±…

CORS ì „ì—­ ì„¤ì • ë° origin íŠ¹ì •

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

```

@Override
public void addCorsMappings(CorsRegistry registry) {
registry.addMapping("/\*_") // ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•´
.allowedOrigins("http://localhost:5173") // í—ˆìš©í•  origin
.allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
.allowedHeaders("_")
.allowCredentials(true)
.maxAge(3600); // preflight ìºì‹± ì‹œê°„ (1ì‹œê°„)
}

```

}
```

ğŸ’¡

í˜„ì¬ ìƒí™© (Helen ë¡œì»¬ - CORS ì „ì—­ ì„¤ì • ì•ˆ í•˜ê³  ìš°íšŒí•œ ìƒíƒœ) :

ì¼ë‹¨ì€ SameSite=Noneìœ¼ë¡œ ì„¤ì •í•´ë‘ê¸° ìœ„í•´ ì¿ í‚¤ë¥¼ ì§ì ‘ ì„¤ì •í•˜ë„ë¡ ë°”ê¾¸ì—ˆë‹¤.

**(SameSite=Noneì€ ë³´ì•ˆìƒ ì¢‹ì§€ ì•Šê¸° ë•Œë¬¸ì— CORS ì„¤ì • ìˆ˜ì • í›„ ë°”ê¿”ì•¼ í•¨)**

## 4. kakaoë¡œ í† í°ì„ ìš”ì²­í•  ë•Œ ë°œìƒí•œ ë¬¸ì œ

postman ìƒìœ¼ë¡œ ìš”ì²­ê³¼ ì‘ë‹µì´ ì„±ê³µì ìœ¼ë¡œ ë°œìƒí•˜ì§€ë§Œ ìŠ¤í”„ë§ì—ì„œ ìš”ì²­í–ˆì„ ë•Œ ì—ëŸ¬ê°€ ë‚¬ë‹¤. ì•Œì•„ë³´ë‹ˆ

`bodyValue()`ë¡œ form-urlencoded ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê³  ìˆëŠ”ë°, **Spring WebClientëŠ” ì´ë ‡ê²Œ ë¬¸ìì—´ë¡œ ì£¼ë©´ `Content-Type` ë¬´ì‹œí•˜ê³  JSONìœ¼ë¡œ ë³´ë‚´ëŠ” ê²½ìš°ê°€ ë§ë‹¤ê³  í•œë‹¤.**

ê·¸ë˜ì„œ ì¹´ì¹´ì˜¤ê°€ **form-urlencodedê°€ ì•„ë‹ˆë¼ê³  íŒë‹¨í•´ì„œ í† í°ì„ ì•ˆ ì¤€ë‹¤ê³ ..**

ì •ë¦¬í•˜ë©´,

- Postmanì€ `x-www-form-urlencoded` í˜•ì‹ìœ¼ë¡œ í™•ì‹¤í•˜ê²Œ ë³´ë‚´ì¤Œ. (ì—ëŸ¬ ë°œìƒx)
- ì§€ê¸ˆ ì½”ë“œì—ì„œëŠ” `.bodyValue(String)`ì„ ì¨ì„œ content-typeë§Œ `form-urlencoded`ë¡œ ì†ì¸ ê²ƒ

ğŸ“¢

1ì°¨ í•´ê²°ì±…
BodyInserters.fromFormData ì¨ì„œ ì „ì†¡í•˜ëŠ” ë°©ë²•

```java
MultiValueMap<String, String> formData = new LinkedMultiValueMap<>();
formData.add("grant_type", "authorization_code");
formData.add("client_id", clientId);
formData.add("client_secret", clientSecret);
formData.add("redirect_uri", redirectUri);
formData.add("code", code);

String token = kakaoWebClient.post()
        .uri("https://kauth.kakao.com/oauth/token")
        .header("Content-Type", "application/x-www-form-urlencoded")
        .body(BodyInserters.fromFormData(formData))
        .retrieve()
        .bodyToMono(KakaoTokenResponse.class)
        .block()
        .getAccess_token();
```

## 5. nicknameê³¼ builder ë¬¸ì œ

user/entity/User ì´ ë¶€ë¶„ì—ì„œ ì•„ë˜ì™€ ê°™ì´ nickname ì»¬ëŸ¼ì˜ nullableì´ false ì¸ë°,

```java
   // íšŒì› ë‹‰ë„¤ì„
    @Column(name = "nickname", nullable = false, length = 15)
    private String nickname;
```

AuthServiceì—ì„œ newUserë¥¼ ì„¤ì •í•  ë•Œ ì•„ë˜ì™€ ê°™ì´ nicknameì„ ì„¤ì •í•˜ì§€ ì•Šì•„ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

```java
  User newUser = userRepository.save(User.builder()
                    .email(kakaoUser.getEmail())
                    .name(kakaoUser.getName())
                    .createdAt(LocalDateTime.now())
                    .build());
```

ğŸ“¢

1ì°¨ í•´ê²°ì±…

nicknameì„ ê¸°ë³¸ ê°’ìœ¼ë¡œ ë„£ì–´ë‘ì–´ì•¼ í•  ê²ƒ ê°™ì•„ì„œ ì„ì‹œ ë°©í¸ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ nicknameì„ ë„£ì–´ì£¼ì—ˆë‹¤. **(ìˆ˜ì • í•„ìš”)**

```java
  User newUser = userRepository.save(User.builder()
                    .email(kakaoUser.getEmail())
                    .name(kakaoUser.getName())
                    .nickname("hyemi")
                    .createdAt(LocalDateTime.now())
                    .build());
```

## ì˜¤ëŠ˜ì˜ íšŒê³ 

ê²°êµ­ ë°±ì—”ë“œë„ ì¡°ê¸ˆ ê±´ë“œë ¤ ë³´ëŠ”êµ¬ë‚˜ ì‹¶ì–´ì„œ ë‚˜ì˜ì§€ ì•Šì•˜ë‹¤. ë¶€íŠ¸ìº í”„ì—ì„œëŠ” ë­ë“  ë°°ìš°ëŠ” ê²Œ ì¤‘ìš”í•˜ë‹ˆê¹ŒğŸ« ğŸ« 

ì‹œê°„ ì•ˆì— ë¹¨ë¦¬ mvpë¥¼ ë§Œë“œë ¤ë©´ ê¸°ë‹¤ë¦¬ëŠ” ê±¸ë¡œ ëë‚˜ë©´ ì•ˆë  ê²ƒ ê°™ë‹¤.
