# ğŸ§¾TIL

## ë‚ ì§œ: 2025-05-07 ğŸ™ğŸ»

# ìë™ ë¡œê·¸ì¸ & ì¸ì¦í•œ ìœ ì €ë§Œ ì ‘ì†í•˜ë„ë¡ êµ¬í˜„í•˜ê¸°

## ğŸ ë¬¸ì œ ìƒí™©

í† í°ì˜ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì˜ ì¿ í‚¤ì— ì €ì¥ë˜ì–´ ìˆì–´ í† í°ì´ ë§Œë£Œë˜ì§€ ì•Šê³  ìœ ì €ê°€ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ í´ë¦­í•˜ì§€ ì•ŠëŠ” í•œ ì¸ì¦ ìƒíƒœê°€ ìœ íš¨í•œë°, â€˜/â€™ ì´ë™ ì‹œ ë§¤ë²ˆ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì ‘ì†í•´ì•¼ í–ˆë‹¤.

## ğŸ” ì›ì¸ ë¶„ì„

ì „ì—­ì ìœ¼ë¡œ ìœ ì €ì˜ ë¡œê·¸ì¸ ì—¬ë¶€ê°€ ê´€ë¦¬ë˜ì§€ ì•Šì•˜ë‹¤.

ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì¸ì¦í•œ ìœ ì €ë§Œ íŠ¹ì • ê²½ë¡œë¡œ ì´ë™í•  ìˆ˜ ìˆê²Œ ì œí•œí•˜ëŠ” ë¼ìš°íŒ… ë¡œì§ì´ êµ¬í˜„ë˜ì§€ ì•Šì•˜ë‹¤.

## âœ… í•´ê²° ë°©ë²•

- ë¡œê·¸ì¸ ì—¬ë¶€ ì „ì—­ì  ê´€ë¦¬ â†’ `AuthContext`
  - context API ì‚¬ìš© ì´ìœ : ë¡œê·¸ì¸ ì—¬ë¶€ì™€ ê°™ì€ ê²½ìš° ìì£¼ ë°”ë€ŒëŠ” ìƒíƒœê°€ ì•„ë‹ˆë©°, ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒì— ë”°ë¼ ì „ì²´ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ ë˜ì–´ë„ ê´œì°®ë‹¤ê³  íŒë‹¨í•˜ì—¬ ì‚¬ìš©í•˜ì˜€ë‹¤.
- ìœ ì €ì˜ ë¡œê·¸ì¸ ì—¬ë¶€ ìŠ¤í† ë¦¬ì§€ ì €ì¥ â†’ `ë¡œì»¬ ìŠ¤í† ë¦¬ì§€`

  - ìƒˆë¡œ ê³ ì¹¨ ì‹œì—ë„ ë¡œê·¸ì¸ ìƒíƒœê°€ ìœ ì§€ ë˜ë„ë¡ í•˜ì˜€ë‹¤.
  - í•´ë‹¹ ìƒíƒœë¥¼ contextì—ì„œ ì°¸ì¡°í•´ Provider ë‚´ë¶€ì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì— ë¿Œë ¤ì¤€ë‹¤.

  ```jsx
  export const AuthProvider = ({ children }: { children: ReactNode }) => {
    const [isAuthenticated, setIsAuthenticated] = useState<boolean>(false);
    const [loading, setLoading] = useState(true);

    // ë¡œê·¸ì¸ ìƒíƒœ ì €ì¥
    const loginUserContext = () => {
      localStorage.setItem('koco_auth_flag', 'true');
      setIsAuthenticated(true);
    };

    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ ì €ì¥
    const logoutUserContext = () => {
      try {
        localStorage.removeItem('koco_auth_flag');
        setIsAuthenticated(false);
      } catch (error) {
        console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨', error);
      }
    };

    useEffect(() => {
      const authFlag = localStorage.getItem('koco_auth_flag');
      setIsAuthenticated(!!authFlag);
      setLoading(false);
    }, []);

    **return (
      <AuthContext.Provider value={{ isAuthenticated, loading, loginUserContext, logoutUserContext }}>
        {children}
      </AuthContext.Provider>
    );
  };
  ```

  `ë¡œê·¸ì¸` koco_auth_flag : true (ë¡œì»¬ìŠ¤í† ë¦¬ì§€)

  `ë¡œê·¸ì•„ì›ƒ` koco_auth_flag ì œê±° (ë¡œì»¬ìŠ¤í† ë¦¬ì§€)

  `loginUserContext` , `logoutUserContext` ëŠ” ê°ê° `useKakaoLogin` , `useLogout` ë®¤í…Œì´ì…˜ í›…ì—ì„œ api ìš”ì²­ ì„±ê³µ ì‹œ (onSuccess) í˜¸ì¶œí•œë‹¤.

- ì¸ì¦ëœ ìœ ì €ë§Œ ì ‘ê·¼í•˜ëŠ” ë¡œì§

  ```tsx
  export const ProtectedRoute = () => {
    const { isAuthenticated, loading } = useAuth();

    if (loading) {
      return <Spinner text="ë¡œê·¸ì¸ ì‹œë„ ì¤‘..." />;
    }

    return isAuthenticated ? <Outlet /> : <Navigate to="/" />;
  };
  ```

  ```jsx
  {
    /* ë¡œê·¸ì¸ ì‹œ ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€ë“¤ */
  }
  <Route element={<ProtectedRoute />}>
    <Route path="/complete-profile" element={<FirstLoginPage />} />
    <Route path="/home" element={<MainPage />} />
    <Route path="/survey" element={<SurveyPage />} />
    <Route path="/problems" element={<ProblemListPage />} />
    <Route path="/problems/:id" element={<ProblemSolutionPage />} />
  </Route>;
  ```

  `useAuth` í†µí•´ `isAuthenticated` ì°¸ì¡°í•´, ì¸ì¦ ìƒíƒœì¸ ê²½ìš° <ProtectedRoute> í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ë Œë”ë§, ì¸ì¦ ë¯¸ì™„ë£Œ ìƒíƒœì¸ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.

- ë¦¬í”„ë ˆì‰¬ í† í° ê°±ì‹  ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ ì‚­ì œ

  ```jsx
  const refreshToken = async () => {
    try {
      const response = await refreshAxios.post('/api/backend/v1/auth/refresh');

      return response.status === 200;
    } catch (error) {
      console.error('í† í° ê°±ì‹  ì‹¤íŒ¨:', error);
      localStorage.removeItem('koco_auth_flag');

      return false;
    }
  ```

  í† í° ê°±ì‹  ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì˜ ì¸ì¦ ìƒíƒœë„ ì‚­ì œí•œë‹¤.

- ìë™ ë¡œê·¸ì¸

  ```jsx
  const LoginPage = () => {
    const navigate = useNavigate();

    const { isAuthenticated } = useAuth();

    useEffect(() => {
      if (isAuthenticated) {
        // ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœë¼ë©´ í™ˆìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜
        navigate("/home");
      }
    }, [isAuthenticated, navigate]);

    return (
      <div className="flex w-full items-center justify-center min-h-screen">
        <LoginCard />
      </div>
    );
  };

  export default LoginPage;
  ```

  - â€˜/â€™ ì ‘ê·¼ ì‹œ ì¸ì¦ ë˜ì–´ ìˆë‹¤ë©´ â€˜/homeâ€™ìœ¼ë¡œ ì´ë™í•œë‹¤.

## íšŒê³ 

ìœ ì €ì˜ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•´, ì´ë¥¼ contextë¡œ ì „ì—­ì ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.

ë”°ë¼ì„œ '/' ì ‘ê·¼ ì‹œ ìë™ìœ¼ë¡œ ì¸ì¦ ì—¬ë¶€ í™•ì¸ í›„ '/home' ì´ë™í•˜ëŠ” ë¡œì§ê³¼ ë¡œê·¸ì¸ ìœ ì €ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ë¼ìš°íŒ…ì„ ì œí•œí•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•˜ì˜€ë‹¤.

ì‚¬ì‹¤ ì ì ˆí•œ ë°©ë²•ì¸ì§€ëŠ” ì˜ ëª¨ë¥´ê² ë‹¤. ì¡°ê¸ˆ ë” ì‹¤ì œ ì›¹ ì‚¬ì´íŠ¸ì—ì„œëŠ” ì–´ë–»ê²Œ ê´€ë¦¬í•˜ê³  ìˆëŠ”ì§€ ì•Œì•„ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.
